# 운영 매뉴얼: PPM 예측 시스템

## 1. 시스템 개요

본 시스템은 캠샤프트 제조 공정에서 Z-Score 기반 PPM(Parts Per Million) 분석을 통해 불량률을 실시간으로 예측하고 선제적 알람을 제공합니다.

## 2. 일일 운영 체크리스트

### 2.1. 시스템 시작 시 점검사항

- [ ] 백엔드 서버 정상 동작 확인 (`http://localhost:8000/docs`)
- [ ] 프론트엔드 대시보드 접속 확인 (`http://localhost:3000`)
- [ ] 데이터베이스 연결 상태 확인
- [ ] 실시간 데이터 수집 상태 확인 (최근 10분 내 데이터 존재)
- [ ] 웹소켓 연결 상태 확인 (실시간 업데이트 동작)

### 2.2. PPM 모니터링 기준

#### 정상 운영 기준

```
✅ 모든 캠의 PPM < 500
✅ PPM 기울기 < ±10 PPM/시간
✅ 알람 없음
✅ 데이터 수집 정상 (5분 간격)
```

#### 주의 필요 상황

```
⚠️ 1-2개 캠의 PPM 500-1000
⚠️ PPM 기울기 10-25 PPM/시간
⚠️ 데이터 수집 지연 (10분 이상)
```

#### 즉시 대응 필요

```
🚨 PPM > 1000 또는 PPM 기울기 > 25 PPM/시간
🚨 3개 이상 캠에서 동시 이상
🚨 시스템 오류 또는 데이터 수집 중단
```

## 3. 알람 대응 매뉴얼

### 3.1. PPM 알람 대응

#### CAUTION (주의) - PPM 500-1000

1. **즉시 조치**: 해당 캠의 원시 데이터 확인
2. **원인 분석**: 최근 2시간 내 공정 변경 사항 점검
3. **모니터링 강화**: 5분 간격으로 PPM 변화 추적
4. **기록**: 알람 발생 시간과 추정 원인 기록

#### WARNING (경고) - PPM 1000-5000

1. **즉시 조치**:
   - 해당 라인의 생산 속도 10% 감속
   - 품질 관리팀 즉시 통보
   - 실시간 샘플링 검사 시작
2. **원인 분석**:
   - 지그, 공구 상태 점검
   - 원료 품질 확인
   - 환경 조건 (온도, 습도) 점검
3. **30분 이내 개선 없으면 생산 중단 검토**

#### CRITICAL (위험) - PPM > 5000

1. **즉시 조치**:
   - 해당 라인 생산 즉시 중단
   - 기계 안전 점검 실시
   - 관리자 및 기술팀 즉시 호출
2. **원인 분석 및 조치**:
   - 전체 시스템 진단
   - 캠 교체 또는 재보정
   - 근본 원인 분석 (Root Cause Analysis)
3. **복구 후 재시작 전 30분간 모니터링**

### 3.2. 기울기 알람 대응

#### 급격한 PPM 증가 (기울기 > 25 PPM/시간)

```
1. 현재 PPM이 낮더라도 즉시 원인 분석 시작
2. 향후 2-4시간 내 임계값 도달 예상
3. 예방적 정비 또는 조정 실시
4. 1시간마다 상황 재평가
```

#### 지속적 PPM 감소 (기울기 < -15 PPM/시간)

```
1. 개선 조치 효과 확인
2. 현재 설정 유지
3. 안정화까지 지속 모니터링
```

## 4. 데이터 분석 가이드

### 4.1. Raw Data 분석

#### 모델별 데이터 조회

1. **Raw Data 탭** 접속
2. **Model Filter** 선택
3. 분석하고자 하는 모델 선택 (예: "ATKINSON 3.8 OCV")
4. **Load Model Data** 클릭

#### 커스텀 쿼리 실행

```sql
-- 예시 1: 특정 기간 고 PPM 데이터 조회
SELECT * FROM HANDY_ZSCORE_RAW_DATA
WHERE d001 = 'ATKINSON 3.8 OCV'
AND create_time >= '2024-01-01'
AND create_time <= '2024-01-31'

-- 예시 2: 특정 값 범위 조회
SELECT d000, d001, d004, d005 FROM HANDY_ZSCORE_RAW_DATA
WHERE d004 > 19.0 AND d005 < 25.0
```

### 4.2. 트렌드 분석

#### PPM 추세 확인

1. **Dashboard** 탭에서 **PPM Chart** 확인
2. 지난 24시간 동안의 PPM 변화 패턴 분석
3. 주기적 패턴이나 이상 징후 탐지

#### 캠별 성능 비교

1. **Process Distribution Chart**에서 모든 캠 성능 비교
2. 편차가 큰 캠 식별
3. 개별 캠 데이터 상세 분석

### 4.3. 백테스팅 분석

#### 예측 모델 성능 검증

1. **Backtesting 탭** 접속
2. 분석 파라미터 설정:
   - Window Size: 50-100 (권장: 75)
   - Z-Threshold: 1.5-3.0 (권장: 2.0)
   - Prediction Horizon: 5-20 (권장: 10)
3. **Run Backtest** 실행
4. 성능 지표 확인:
   - Accuracy > 80%: 우수
   - Precision > 70%: 양호
   - Recall > 60%: 기본

## 5. 시스템 유지보수

### 5.1. 일간 유지보수

#### 데이터 정합성 점검

```bash
# 스크립트 실행 디렉토리로 이동
cd C:\workspace\z-score\scripts

# 데이터 검증
python load_data.py --verify-only

# 예상 출력:
# 📊 총 데이터 개수: 804,511개 행
# 📋 컬럼 매퍼: 10개
```

#### 로그 파일 점검

- 백엔드 에러 로그 확인 (`backend/logs/`)
- 데이터 수집 실패 건수 확인
- 성능 지표 모니터링 (응답 시간, 메모리 사용량)

### 5.2. 주간 유지보수

#### 데이터 정리

```bash
# 3개월 이상된 원시 데이터 아카이브
python scripts/archive_old_data.py --months 3

# 분석 결과 테이블 최적화
python scripts/optimize_analysis_tables.py
```

#### 모델 성능 리뷰

- 지난 주 PPM 예측 정확도 분석
- 알람 false positive 비율 점검
- 임계값 조정 필요성 검토

### 5.3. 월간 유지보수

#### 모델 재보정

1. **지난 월 성능 데이터 수집**
2. **통계적 임계값 재계산**
3. **계절적 패턴 분석 및 반영**
4. **새로운 제품 모델 추가 검토**

## 6. 문제 해결

### 6.1. 일반적인 문제와 해결책

#### PPM이 0으로 표시되는 경우

```
원인: 데이터 부족 또는 표준편차 0
해결책:
1. 최근 데이터 수집 상태 확인
2. 측정 장비 동작 상태 점검
3. 데이터베이스 연결 확인
```

#### 실시간 업데이트가 안 되는 경우

```
원인: 웹소켓 연결 문제
해결책:
1. 브라우저 새로고침 (F5)
2. 백엔드 서버 재시작
3. 방화벽 설정 확인
```

#### 특정 캠의 PPM이 비정상적으로 높은 경우

```
원인: 센서 오류 또는 공정 이상
해결책:
1. 해당 캠 센서 케이블 점검
2. 캘리브레이션 상태 확인
3. 물리적 장비 상태 점검
```

### 6.2. 응급 상황 대응

#### 전체 시스템 다운

```
1. 즉시 조치:
   - 모든 생산 라인 일시 중단
   - IT 팀 즉시 연락
   - 수동 품질 검사로 전환

2. 복구 절차:
   - 시스템 재시작
   - 데이터 정합성 확인
   - 단계별 생산 재개
```

#### 대량 알람 발생

```
1. 전체 시스템 점검
2. 공통 원인 분석 (전력, 환경, 원료)
3. 우선순위별 대응 (Critical → Warning → Caution)
4. 근본 원인 해결 후 시스템 안정화 확인
```

## 7. 성과 지표 및 KPI

### 7.1. 시스템 성과 지표

| 지표           | 목표  | 측정 방법              |
| -------------- | ----- | ---------------------- |
| 예측 정확도    | > 85% | 월간 백테스팅 결과     |
| 알람 정확도    | > 80% | False Positive 비율    |
| 시스템 가용성  | > 99% | 월간 운영 시간         |
| 평균 응답 시간 | < 2초 | API 응답 시간 모니터링 |

### 7.2. 품질 개선 지표

| 지표        | 현재 | 목표      | 개선율 |
| ----------- | ---- | --------- | ------ |
| 실제 불량률 | -    | < 300 PPM | -      |
| 예방된 불량 | -    | > 50%     | -      |
| 조기 감지율 | -    | > 90%     | -      |
| 대응 시간   | -    | < 30분    | -      |

## 8. 연락처 및 에스컬레이션

### 8.1. 담당자 연락처

```
시스템 관리자: [담당자명] - [연락처]
품질 관리팀: [담당자명] - [연락처]
IT 지원팀: [담당자명] - [연락처]
생산 관리자: [담당자명] - [연락처]
```

### 8.2. 에스컬레이션 절차

```
Level 1: 현장 작업자 → 즉시 대응 (5분 이내)
Level 2: 품질 관리자 → 원인 분석 (15분 이내)
Level 3: 생산 관리자 → 생산 조정 (30분 이내)
Level 4: 기술 임원 → 전략적 의사결정 (1시간 이내)
```
