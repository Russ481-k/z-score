# 캠샤프트 제조 라인 불량률 예측 및 알람 시스템 개발 계획

## 1. 프로젝트 개요

본 프로젝트의 목표는 캠샤프트 제조 라인에서 수집되는 6개 위상각 데이터를 분석하여 불량률을 예측하고, 이상 징후 발생 시 실시간으로 알람을 제공하는 시스템을 구축하는 것입니다. Z-score 분석을 통해 데이터의 이상치를 탐지하고, 나아가 Z-score 분포의 밀도와 범위 변화 기울기를 분석하여 공정의 불안정성 및 불량률 증가를 예측하는 고도화된 모델을 적용합니다.

## 2. 주요 기능

- **데이터 파싱 및 정제:** `data` 폴더에 시계열로 저장되는 CSV 데이터를 주기적으로 읽어와 파싱하고, 분석 가능한 형태로 정제합니다.
- **Z-score 계산:** 6개의 위상각 데이터에 대한 Z-score를 계산하여 각 데이터 포인트의 정규 분포상 위치를 파악합니다.
- **분포 기반 불량률 예측 모델:**
  - **밀도 측정:** 각 위상각별 Z-score 데이터의 분포를 측정하고, Kernel Density Estimation (KDE) 등을 사용하여 밀도를 계산합니다.
  - **기울기 도출:** 시간 흐름에 따른 분포의 밀도 변화와 범위(표준편차 등) 변화를 추적합니다. 밀도가 낮아지고 범위가 넓어지는 추세의 기울기를 계산하여, 공정이 불안정해지거나 불량률이 증가하는 패턴을 예측합니다.
- **데이터 시각화:** 원본 데이터, Z-score, 분포 밀도, 예측 기울기 등을 프론트엔드 대시보드에서 차트와 그리드로 시각화하여 제공합니다. (ag-Grid 활용)
- **실시간 알람:** 특정 임계치를 초과하는 이상 데이터 또는 예측된 불량률 증가 기울기가 감지될 경우, 사용자에게 실시간으로 알람을 보냅니다.
- **데이터베이스 연동:** 처리된 데이터와 분석 결과(Z-score, 밀도, 기울기 등)를 Oracle 및 MariaDB와 호환되는 데이터베이스에 저장하고 관리합니다.

## 3. 기술 스택 (Context7 MCP 기반)

- **Backend API:**
  - **Framework:** FastAPI
  - **언어:** Python 3.12.10
  - **패키지 관리:** Poetry
  - **Data Analysis:** Pandas, NumPy, Scikit-learn
- **Frontend:**
  - **Framework:** Next.js
  - **상태 관리/API 통신:** React Query
  - **UI 컴포넌트:** ag-Grid (차트 및 그리드), SCSS
- **Database:**
  - Oracle, MariaDB (호환 가능하도록 설계)
- **Deployment:**
  - Docker Compose

## 4. 시스템 아키텍처

```mermaid
graph TD
    A[CSV Files in /data] --> B{데이터 처리<br/>(Python/Pandas)};
    B --> G{Z-score 계산 및<br/>분포 분석};
    G --> C[데이터베이스<br/>(Oracle/MariaDB)];
    C --> D[Backend API<br/>(FastAPI)];
    D --> E[Frontend<br/>(Next.js)];
    E --> F[사용자<br/>(웹 브라우저)];

    subgraph "데이터 수집 및 처리"
        A
        B
        G
    end

    subgraph "데이터 저장"
        C
    end

    subgraph "서비스 제공"
        D
        E
    end
```

## 5. 개발 단계 및 절차

1.  **환경 설정:**
    - **Python 환경:** `poetry`를 사용하여 Python 3.12.10 기반의 가상 환경을 구성하고 의존성을 관리합니다.
    - **통합 환경:** Docker Compose를 사용하여 개발 환경(FastAPI, Next.js, DB)을 구성합니다.
2.  **데이터 파이프라인 구축:**
    - `data` 폴더의 모든 CSV 파일을 읽어오는 스케줄러 또는 배치 프로세스를 구현합니다.
    - 파일 인코딩(`EUC-KR`), 헤더 구조 등을 고려하여 안정적인 파싱 로직을 개발합니다.
3.  **예측 모델 개발 (TDD):**
    - **Z-score 계산:** 위상각 데이터에 대한 Z-score 계산 로직을 개발하고 테스트합니다.
    - **분포 분석:** Z-score 분포의 밀도(KDE) 및 범위(표준편차)를 계산하는 함수를 개발합니다.
    - **기울기 분석:** 시계열 데이터에 따른 밀도와 범위의 변화율(기울기)을 계산하는 로직을 구현하고, 불량률 증가 예측 모델을 수립합니다.
4.  **백엔드 API 개발:**
    - 원본 데이터, Z-score, 분포 분석 결과, 예측 기울기 등을 제공하는 API 엔드포인트를 개발합니다.
    - 기간별, 조건별 데이터 조회가 가능한 API를 구현합니다.
5.  **프론트엔드 개발:**
    - ag-Grid를 사용하여 원본 데이터 및 분석 결과를 표 형태로 시각화합니다.
    - 차트 라이브러리를 사용하여 위상각 데이터, Z-score 분포, 밀도 및 기울기 변화 추이를 시각화합니다.
    - 실시간 알람을 표시할 UI를 구현합니다.
6.  **통합 및 테스트:**
    - 백엔드와 프론트엔드를 연동하고 전체 시스템의 동작을 테스트합니다.
    - 실제 데이터를 기반으로 불량률 예측 모델의 정확도를 검증하고 개선합니다.
7.  **배포:** Docker Compose를 사용하여 최종 애플리케이션을 배포합니다.

## 6. Cursor Rules (개발 규칙)

- **언어:** 모든 주석과 문서는 한국어로 작성합니다.
- **코드 스타일:** [Black](https://github.com/psf/black) 포맷터를 사용하여 Python 코드 스타일을 통일합니다.
- **데이터베이스 호환성:** 특정 DB에 종속적인 쿼리 대신, SQLAlchemy와 같은 ORM을 사용하여 Oracle과 MariaDB 간 호환성을 확보합니다.
- **API 명세:** FastAPI의 자동 문서 생성 기능(Swagger UI)을 적극 활용하여 API 명세를 최신으로 유지합니다.
- **TDD:** 핵심 로직(Z-score 계산, 예측 모델)에 대해서는 테스트 코드를 먼저 작성하는 TDD(Test-Driven Development) 방식을 따릅니다. [[memory:268055]]
- **개발 순서:** 프로젝트는 다음 순서에 따라 개발을 진행합니다. [[memory:4111132]]
  1.  **통합 환경 구축:** Docker Compose를 사용하여 개발 환경(FastAPI, Next.js, DB)을 구성합니다.
  2.  **백엔드 개발 (FastAPI):**
      - 데이터 파이프라인 구현
      - 데이터베이스 연동 및 모델 정의
      - 예측 모델 로직 개발 (TDD)
      - API 엔드포인트 구현
  3.  **프론트엔드 개발 (Next.js):**
      - 프로젝트 구조 설정 및 라이브러리 설치
      - API 연동 및 상태 관리 (React Query)
      - UI 컴포넌트 개발 (AG-Grid, 차트 등)
  4.  **통합 및 배포:**
      - 시스템 통합 테스트
      - Docker를 이용한 최종 배포
