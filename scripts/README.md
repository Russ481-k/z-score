# 통합 CSV 데이터 로더

캠샤프트 제조 라인의 CSV 데이터를 Oracle DB에 로딩하고 관리하는 통합 스크립트입니다.

## 주요 기능

### 1. 데이터 분석

- CSV 파일 구조 및 인코딩 자동 감지
- 파일별 행/컬럼 수 통계
- 샘플 데이터 미리보기

### 2. 데이터 로딩

- EUC-KR 우선 다중 인코딩 지원
- 첫 2행 헤더 자동 건너뛰기
- 유효한 데이터만 필터링 (바코드 필드 기준)
- 150개 D-컬럼에 자동 패딩
- 배치 처리 및 진행률 표시

### 3. 데이터 관리

- 기존 데이터 완전 삭제
- 시퀀스 자동 리셋
- 트랜잭션 안전성

### 4. 데이터 검증

- 로드된 데이터 개수 확인
- 컬럼 매퍼 연동 샘플 출력
- 데이터 범위 통계

## 사용법

### 기본 사용법

```bash
# 기본 데이터 로딩 (기존 데이터 유지)
python load_data.py

# 기존 데이터 삭제 후 새로 로딩
python load_data.py --clear-data

# 확인 없이 자동 실행
python load_data.py --clear-data --no-confirm
```

### 분석 전용

```bash
# CSV 파일 구조 분석만 수행
python load_data.py --analyze-only

# 분석할 파일 개수 지정 (기본값: 5)
python load_data.py --analyze-only --analyze-count 10
```

### 검증 전용

```bash
# 기존 데이터 검증만 수행
python load_data.py --verify-only
```

## 환경 설정

### 필수 환경 변수 (.env 파일)

```env
ORACLE_USER=your_username
ORACLE_PASSWORD=your_password
ORACLE_DSN=your_dsn
```

### 디렉토리 구조

```
z-score/
├── scripts/
│   └── load_data.py      # 통합 스크립트
├── .cursor/
│   └── data/             # CSV 파일 디렉토리
│       ├── 2024/
│       ├── 2025/
│       └── *.csv
└── oracle/
    └── instantclient_23_8/   # Oracle Instant Client
```

## 처리 결과 예시

```
🚀 === 통합 CSV 데이터 로더 ===
실행 시간: 2025-07-31 09:05:39

🔍 === CSV 파일 구조 분석 ===
발견된 CSV 파일: 416개
분석할 파일: 3개

📥 === 데이터 로딩 시작 ===
처리할 CSV 파일: 416개
진행률: 50/416 (12.0%)
진행률: 100/416 (24.0%)
...

✅ === 데이터 로딩 완료 ===
📊 처리된 파일: 416/416
💾 총 삽입 데이터: 804,511개 행
⏭️ 건너뛴 파일: 0개

🔍 === 데이터 검증 ===
📊 총 데이터 개수: 804,511개 행
📋 컬럼 매퍼: 10개

🎉 모든 작업이 완료되었습니다!
```

## 오류 처리

- **인코딩 오류**: 다중 인코딩 시도 (EUC-KR → cp949 → utf-8-sig → utf-8 → latin-1)
- **파싱 오류**: 문제 있는 행 자동 건너뛰기
- **DB 오류**: 파일별 트랜잭션으로 부분 실패 방지
- **데이터 검증**: 바코드 필드 존재 여부로 유효성 검사

## 성능 특징

- **배치 처리**: `executemany()`로 대량 삽입
- **메모리 효율**: 파일별 순차 처리
- **타입 안전성**: 모든 데이터를 VARCHAR로 처리
- **진행률 표시**: 50개 파일마다 진행률 출력

## 데이터베이스 스키마

### HANDY_ZSCORE_RAW_DATA 테이블

- `id`: 기본키 (시퀀스 자동 생성)
- `create_time`: 생성 시간 (자동)
- `d000` ~ `d149`: 데이터 컬럼 (150개)

### HANDY_ZSCORE_COLUMN_MAPPER 테이블

- 컬럼 매핑 정보 연동
- 데이터 검증 시 자동 활용
